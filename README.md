# Dashboard for neuroimaging and phenotypic dataset exploration

- [Overview](#overview)  
- [Preview](#preview)  
- [Input schema](#input-schema)  
- [Creating a dashboard-ready dataset file](#creating-a-dataset-file-for-the-dashboard-bagelcsv)  
- [Local development](#local-development)

## Overview
`digest` is a web dashboard that provides interactive visual summaries and subject-level querying based on neuroimaging derivatives and phenotypic variables available for a dataset.

A `digest` dashboard can be generated for any tabular dataset file that follows a data modality-specific [schema](/schemas/), which we refer to as a "bagel" file.
The dashboard is compatible with the processing status `bagel.csv` files automatically generated by the [Nipoppy framework for neuroimaging dataset organization and processing](https://github.com/neurodatascience/nipoppy).

For more information on how to use `digest` with the Nipoppy project, also see the official [Nipoppy documentation](https://neurobagel.org/nipoppy/overview/).

**Quickstart**: https://digest.neurobagel.org/

## Preview
![alt text](img/ui_overview_table.png?raw=true)
![alt text](img/ui_overview_plots.png?raw=true)

## Input schema
Input files to the dashboard contain long format data that must be formatted according to the [bagel schema](/schemas/) (see also the schemas [README](https://github.com/neurobagel/digest/tree/main/schemas#readme) for more info). A single file is expected to correspond to one dataset, but may contain status information for multiple processing pipelines for that dataset.

### Try it out
You can view and download correctly formatted, minimal input tabular files from [here](/example_bagels/) to test out dashboard functionality.

## Creating a dashboard-ready dataset file (`bagel.csv`)
While `digest` works on any input CSV compliant with a [bagel schema](/schemas/), the easiest way to generate a dashboard-ready file for a dataset's neuroimaging processing info is to follow the [Nipoppy](https://neurobagel.org/nipoppy/overview/) standard structure for organizing raw MRI data and processed outputs (data derivatives). 
`Nipoppy` offers scripts that can use this standardized dataset organization to automatically extract info about the raw imaging files and any pipelines that have been run, which is then stored in a dashboard-ready `bagel.csv`.

Detailed instructions to get started using `Nipoppy` can be found in their [documentation](https://neurobagel.org/nipoppy/overview/). 
In brief, generating a `bagel.csv` for your dataset can be as simple as:
1. Installing `Nipoppy` to generate a dataset directory tree for your dataset (see [Installation](https://neurobagel.org/nipoppy/installation/) section of docs) that you can populate with your existing data
2. Update `Nipoppy` configuration to reflect the pipeline versions you are using (for tracking purposes), and augment your participant spreadsheet according to `Nipoppy` requirements (see [Configs](https://neurobagel.org/nipoppy/configs/) section of docs)
3. Run the tracker ([run_tracker.py](https://github.com/neurodatascience/nipoppy/blob/main/trackers/run_tracker.py)) for the relevant pipeline(s) for your dataset to generate a comprehensive `bagel.csv`
    - To see help text for this script: `python run_tracker.py --help`
    - This step can be repeated as needed to update the `bagel.csv` with newly processed subjects

## Local development
To install `digest` from the source repository, run the following in a Python environment:
```bash
git clone https://github.com/neurobagel/digest.git
cd digest
pip install -r requirements.txt
```

To launch the app locally:
```bash
python -m digest.app
```
Once the server is running, the dashboard can be accessed at http://127.0.0.1:8050/ in your browser.

### Testing
`pytest` and `dash.testing` are used for testing dashboard functionality during development.

To run the tests, first install a WebDriver for the Dash app tests to interact with a Chrome browser, following the [ChromeDriver Getting Started Guide](https://chromedriver.chromium.org/getting-started). Once you have downloaded the correct ChromeDriver binary for your installed version of Chrome, add the location to your PATH by running the following command:
```bash
export PATH=$PATH:/path/to/your/folder/containing/ChromeDriver
```
You may have to repeat this step each time your Python environment is re-activated.

To run the tests, run the following command from the repository's root:
```bash
pytest tests
```
